<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Schema Prompting for Chart.js - Test Page</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .section h3 {
            color: #1e293b;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .json-schema {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .test-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-panel h4 {
            margin-bottom: 15px;
            color: #374151;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            margin: 5px;
            width: 100%;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .chart-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 400px;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .json-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .prompt-example {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .prompt-example h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .prompt-text {
            background: white;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        @media (max-width: 768px) {
            .test-controls {
                grid-template-columns: 1fr;
            }
            
            .chart-demo {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä JSON Schema Prompting for Chart.js</h1>
            <p>Testing structured LLM output for professional chart generation</p>
        </div>
        
        <div class="content">
            <!-- JSON Schema Definition -->
            <div class="section">
                <h3>üèóÔ∏è Chart.js JSON Schema Definition</h3>
                <p>This schema ensures the LLM generates properly structured Chart.js configurations:</p>
                
                <div class="json-schema" id="schema-display">
                    <strong>Loading schema...</strong>
                </div>
            </div>
            
            <!-- LLM Prompt Example -->
            <div class="section">
                <h3>ü§ñ Enhanced LLM Prompt with JSON Schema</h3>
                <p>This is how we'll instruct the LLM to generate structured Chart.js configurations:</p>
                
                <div class="prompt-example">
                    <h4>üìù Structured JSON Prompt:</h4>
                    <div class="prompt-text" id="prompt-display">
                        Loading prompt example...
                    </div>
                </div>
            </div>
            
            <!-- Test Controls -->
            <div class="test-controls">
                <div class="control-panel">
                    <h4>üìà Chart Type Testing</h4>
                    <button class="btn btn-primary" onclick="testChartType('bar')">Generate Bar Chart</button>
                    <button class="btn btn-primary" onclick="testChartType('line')">Generate Line Chart</button>
                    <button class="btn btn-primary" onclick="testChartType('pie')">Generate Pie Chart</button>
                    <button class="btn btn-primary" onclick="testChartType('scatter')">Generate Scatter Plot</button>
                </div>
                
                <div class="control-panel">
                    <h4>üìä Data Scenarios</h4>
                    <button class="btn btn-success" onclick="testDataScenario('sales')">Sales Data</button>
                    <button class="btn btn-success" onclick="testDataScenario('timeseries')">Time Series</button>
                    <button class="btn btn-success" onclick="testDataScenario('categorical')">Categories</button>
                    <button class="btn btn-success" onclick="testDataScenario('multivariate')">Multi-variable</button>
                </div>
            </div>
            
            <!-- Chart Demonstration -->
            <div class="chart-demo">
                <div class="chart-container">
                    <div class="chart-title">Generated Chart</div>
                    <canvas id="testChart" style="max-height: 300px;"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Generated JSON Configuration</div>
                    <div class="json-output" id="json-output">
                        Click a button above to generate a chart configuration...
                    </div>
                </div>
            </div>
            
            <!-- Benefits Section -->
            <div class="section">
                <h3>üéØ Benefits of JSON Schema Prompting</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                        <strong style="color: #059669;">‚úì Structured Output</strong><br>
                        <small style="color: #6b7280;">LLM generates valid JSON every time</small>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <strong style="color: #2563eb;">‚úì Type Safety</strong><br>
                        <small style="color: #6b7280;">Proper data types and validation</small>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <strong style="color: #d97706;">‚úì Consistent Quality</strong><br>
                        <small style="color: #6b7280;">Reliable chart generation</small>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                        <strong style="color: #7c3aed;">‚úì Easy Debugging</strong><br>
                        <small style="color: #6b7280;">Clear error identification</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chart.js Configuration JSON Schema
        const chartJSSchema = {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "title": "Chart.js Configuration for DataViz Pro",
            "type": "object",
            "properties": {
                "charts": {
                    "type": "array",
                    "description": "Array of chart configurations to render",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "string",
                                "description": "Unique identifier for the chart canvas element"
                            },
                            "type": {
                                "type": "string",
                                "enum": ["bar", "line", "pie", "doughnut", "scatter", "radar", "polarArea"],
                                "description": "Chart.js chart type"
                            },
                            "title": {
                                "type": "string",
                                "description": "Chart title to display"
                            },
                            "data": {
                                "type": "object",
                                "properties": {
                                    "labels": {
                                        "type": "array",
                                        "items": { "type": "string" },
                                        "description": "X-axis labels for the chart"
                                    },
                                    "datasets": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "label": { "type": "string" },
                                                "data": {
                                                    "type": "array",
                                                    "items": { "type": "number" }
                                                },
                                                "backgroundColor": {
                                                    "oneOf": [
                                                        { "type": "string" },
                                                        { "type": "array", "items": { "type": "string" } }
                                                    ]
                                                },
                                                "borderColor": {
                                                    "oneOf": [
                                                        { "type": "string" },
                                                        { "type": "array", "items": { "type": "string" } }
                                                    ]
                                                },
                                                "borderWidth": { "type": "number" }
                                            },
                                            "required": ["label", "data"]
                                        }
                                    }
                                },
                                "required": ["labels", "datasets"]
                            },
                            "options": {
                                "type": "object",
                                "properties": {
                                    "responsive": { "type": "boolean" },
                                    "maintainAspectRatio": { "type": "boolean" },
                                    "plugins": {
                                        "type": "object",
                                        "properties": {
                                            "title": {
                                                "type": "object",
                                                "properties": {
                                                    "display": { "type": "boolean" },
                                                    "text": { "type": "string" }
                                                }
                                            },
                                            "legend": {
                                                "type": "object",
                                                "properties": {
                                                    "display": { "type": "boolean" },
                                                    "position": {
                                                        "type": "string",
                                                        "enum": ["top", "bottom", "left", "right"]
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "scales": {
                                        "type": "object",
                                        "properties": {
                                            "x": {
                                                "type": "object",
                                                "properties": {
                                                    "beginAtZero": { "type": "boolean" },
                                                    "title": {
                                                        "type": "object",
                                                        "properties": {
                                                            "display": { "type": "boolean" },
                                                            "text": { "type": "string" }
                                                        }
                                                    }
                                                }
                                            },
                                            "y": {
                                                "type": "object",
                                                "properties": {
                                                    "beginAtZero": { "type": "boolean" },
                                                    "title": {
                                                        "type": "object",
                                                        "properties": {
                                                            "display": { "type": "boolean" },
                                                            "text": { "type": "string" }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "required": ["id", "type", "title", "data"]
                    }
                },
                "kpis": {
                    "type": "array",
                    "description": "Key Performance Indicators to display",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": { "type": "string" },
                            "value": { "type": ["string", "number"] },
                            "format": {
                                "type": "string",
                                "enum": ["number", "currency", "percentage", "text"]
                            },
                            "trend": {
                                "type": "object",
                                "properties": {
                                    "direction": {
                                        "type": "string",
                                        "enum": ["up", "down", "neutral"]
                                    },
                                    "percentage": { "type": "number" }
                                }
                            }
                        },
                        "required": ["label", "value"]
                    }
                }
            },
            "required": ["charts"]
        };

        // Enhanced LLM Prompt Template
        const enhancedPrompt = `You are an expert data visualization analyst. Generate Chart.js configurations based on CSV data analysis.

**STRICT JSON OUTPUT REQUIREMENT**: 
You MUST respond with ONLY a valid JSON object following this exact schema. No markdown, no explanations, just pure JSON.

**JSON SCHEMA TO FOLLOW:**
${JSON.stringify(chartJSSchema, null, 2)}

**INSTRUCTIONS:**
1. Analyze the provided CSV data structure and content
2. Determine the most appropriate chart type(s) based on data characteristics:
   - Categorical data with numbers ‚Üí Bar Chart
   - Time series data ‚Üí Line Chart
   - Part-to-whole relationships ‚Üí Pie Chart
   - Two numeric variables ‚Üí Scatter Plot
3. Generate 1-3 charts maximum for clarity
4. Calculate meaningful KPIs from the data (totals, averages, counts, etc.)
5. Use professional color schemes and styling
6. Ensure all chart data corresponds to actual CSV values
7. Make charts responsive and accessible

**DATA ANALYSIS GUIDELINES:**
- For bar charts: Group by categorical columns, aggregate numeric values
- For line charts: Use time/sequence columns for X-axis, numeric for Y-axis  
- For pie charts: Show distribution of categories (top 5-8 items max)
- For scatter plots: Plot two numeric columns against each other

**CSV DATA TO ANALYZE:**
`;

        // Sample data scenarios for testing
        const dataSamples = {
            sales: {
                headers: ['Quarter', 'Revenue', 'Units Sold', 'Region'],
                rows: [
                    ['Q1 2024', '45000', '120', 'North'],
                    ['Q2 2024', '52000', '140', 'North'],
                    ['Q3 2024', '48000', '130', 'South'],
                    ['Q4 2024', '61000', '165', 'South']
                ]
            },
            timeseries: {
                headers: ['Date', 'Active Users', 'Page Views', 'Bounce Rate'],
                rows: [
                    ['2024-01', '1200', '4500', '0.32'],
                    ['2024-02', '1450', '5200', '0.28'],
                    ['2024-03', '1680', '6100', '0.25'],
                    ['2024-04', '1920', '7200', '0.22']
                ]
            },
            categorical: {
                headers: ['Product Category', 'Sales Amount', 'Units', 'Profit Margin'],
                rows: [
                    ['Electronics', '25000', '45', '0.35'],
                    ['Clothing', '18000', '120', '0.42'],
                    ['Books', '8000', '200', '0.25'],
                    ['Home & Garden', '15000', '60', '0.38']
                ]
            },
            multivariate: {
                headers: ['Employee', 'Experience Years', 'Salary', 'Performance Score', 'Department'],
                rows: [
                    ['Alice', '5', '75000', '8.5', 'Engineering'],
                    ['Bob', '8', '95000', '9.1', 'Engineering'], 
                    ['Carol', '3', '65000', '7.8', 'Marketing'],
                    ['David', '12', '120000', '9.5', 'Engineering']
                ]
            }
        };

        let currentChart = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displaySchema();
            displayPrompt();
        });

        function displaySchema() {
            document.getElementById('schema-display').innerHTML = 
                `<pre>${JSON.stringify(chartJSSchema, null, 2)}</pre>`;
        }

        function displayPrompt() {
            document.getElementById('prompt-display').textContent = enhancedPrompt;
        }

        function testChartType(chartType) {
            // Generate mock configuration for the specified chart type
            const mockConfig = generateMockConfig(chartType);
            displayJsonOutput(mockConfig);
            renderChart(mockConfig);
        }

        function testDataScenario(scenario) {
            const data = dataSamples[scenario];
            const mockConfig = generateConfigFromData(data, scenario);
            displayJsonOutput(mockConfig);
            renderChart(mockConfig);
        }

        function generateMockConfig(chartType) {
            const configs = {
                bar: {
                    charts: [{
                        id: "testChart",
                        type: "bar",
                        title: "Sample Bar Chart",
                        data: {
                            labels: ["Product A", "Product B", "Product C", "Product D"],
                            datasets: [{
                                label: "Sales Revenue",
                                data: [25000, 35000, 15000, 42000],
                                backgroundColor: [
                                    "rgba(59, 130, 246, 0.8)",
                                    "rgba(16, 185, 129, 0.8)",
                                    "rgba(245, 158, 11, 0.8)",
                                    "rgba(139, 92, 246, 0.8)"
                                ],
                                borderColor: "rgba(59, 130, 246, 1)",
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Revenue by Product" },
                                legend: { display: true, position: "top" }
                            },
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: "Revenue ($)" } }
                            }
                        }
                    }],
                    kpis: [
                        { label: "Total Revenue", value: 117000, format: "currency" },
                        { label: "Best Product", value: "Product D", format: "text" },
                        { label: "Average Revenue", value: 29250, format: "currency" }
                    ]
                },
                line: {
                    charts: [{
                        id: "testChart",
                        type: "line",
                        title: "Growth Trend",
                        data: {
                            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
                            datasets: [{
                                label: "Monthly Growth",
                                data: [1200, 1900, 3000, 5000, 4200, 6800],
                                backgroundColor: "rgba(59, 130, 246, 0.1)",
                                borderColor: "rgba(59, 130, 246, 1)",
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Monthly User Growth" }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    }]
                },
                pie: {
                    charts: [{
                        id: "testChart",
                        type: "pie",
                        title: "Market Share",
                        data: {
                            labels: ["Product A", "Product B", "Product C", "Product D"],
                            datasets: [{
                                label: "Market Share",
                                data: [30, 25, 20, 25],
                                backgroundColor: [
                                    "rgba(59, 130, 246, 0.8)",
                                    "rgba(16, 185, 129, 0.8)",
                                    "rgba(245, 158, 11, 0.8)",
                                    "rgba(139, 92, 246, 0.8)"
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Market Distribution" },
                                legend: { position: "right" }
                            }
                        }
                    }]
                },
                scatter: {
                    charts: [{
                        id: "testChart",
                        type: "scatter",
                        title: "Performance Analysis",
                        data: {
                            labels: [],
                            datasets: [{
                                label: "Performance vs Experience",
                                data: [
                                    {x: 2, y: 7.5}, {x: 5, y: 8.2}, {x: 8, y: 9.1}, 
                                    {x: 3, y: 7.8}, {x: 12, y: 9.5}, {x: 6, y: 8.7}
                                ],
                                backgroundColor: "rgba(59, 130, 246, 0.6)",
                                borderColor: "rgba(59, 130, 246, 1)",
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Experience vs Performance" }
                            },
                            scales: {
                                x: { title: { display: true, text: "Years Experience" } },
                                y: { title: { display: true, text: "Performance Score" } }
                            }
                        }
                    }]
                }
            };
            
            return configs[chartType] || configs.bar;
        }

        function generateConfigFromData(data, scenario) {
            // This simulates what the LLM would generate based on actual CSV data
            if (scenario === 'sales') {
                return {
                    charts: [{
                        id: "testChart",
                        type: "bar",
                        title: "Quarterly Revenue Analysis",
                        data: {
                            labels: data.rows.map(row => row[0]),
                            datasets: [{
                                label: "Revenue ($)",
                                data: data.rows.map(row => parseInt(row[1])),
                                backgroundColor: "rgba(16, 185, 129, 0.8)",
                                borderColor: "rgba(16, 185, 129, 1)",
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Revenue by Quarter" }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    }],
                    kpis: [
                        { label: "Total Revenue", value: 206000, format: "currency" },
                        { label: "Best Quarter", value: "Q4 2024", format: "text" },
                        { label: "Average Revenue", value: 51500, format: "currency" }
                    ]
                };
            }
            
            // Add more scenario handlers as needed
            return generateMockConfig('bar');
        }

        function displayJsonOutput(config) {
            document.getElementById('json-output').innerHTML = 
                `<pre>${JSON.stringify(config, null, 2)}</pre>`;
        }

        function renderChart(config) {
            // Destroy existing chart
            if (currentChart) {
                currentChart.destroy();
            }
            
            const canvas = document.getElementById('testChart');
            const ctx = canvas.getContext('2d');
            
            if (config.charts && config.charts.length > 0) {
                const chartConfig = config.charts[0];
                currentChart = new Chart(ctx, {
                    type: chartConfig.type,
                    data: chartConfig.data,
                    options: chartConfig.options || {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }
    </script>
</body>
</html>