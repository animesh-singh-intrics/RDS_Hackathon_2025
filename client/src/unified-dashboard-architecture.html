<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Dashboard Generation - Architecture Demo</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .architecture-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .approach-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .approach-card.recommended {
            border-color: #10b981;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15);
        }
        
        .approach-card.not-recommended {
            border-color: #ef4444;
            opacity: 0.7;
        }
        
        .approach-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .recommended .approach-title {
            color: #059669;
        }
        
        .not-recommended .approach-title {
            color: #dc2626;
        }
        
        .pros-cons {
            margin-top: 15px;
        }
        
        .pros, .cons {
            margin-bottom: 15px;
        }
        
        .pros h5, .cons h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .pros h5 { color: #059669; }
        .cons h5 { color: #dc2626; }
        
        .pros ul, .cons ul {
            list-style: none;
            padding-left: 0;
        }
        
        .pros li, .cons li {
            font-size: 0.85rem;
            margin-bottom: 5px;
            padding-left: 20px;
            position: relative;
        }
        
        .pros li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #059669;
            font-weight: bold;
        }
        
        .cons li::before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: #dc2626;
            font-weight: bold;
        }
        
        .demo-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .demo-section h3 {
            color: #1e293b;
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .schema-display {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .dashboard-preview {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-container {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            height: 300px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-title {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .success-message {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #059669;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .architecture-comparison {
                grid-template-columns: 1fr;
            }
            
            .performance-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Optimal Dashboard Generation Architecture</h1>
            <p>Expert analysis: Single Unified Prompt vs Multi-Prompt Approach</p>
        </div>
        
        <div class="content">
            <!-- Architecture Comparison -->
            <div class="architecture-comparison">
                <!-- Recommended Approach -->
                <div class="approach-card recommended">
                    <div class="approach-title">
                        ‚úÖ Single Unified Prompt (RECOMMENDED)
                    </div>
                    <p><strong>Structure:</strong> One prompt generates complete dashboard with HTML structure + Chart.js configs + KPIs in unified JSON</p>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì PROS:</h5>
                            <ul>
                                <li>Cohesive design and theming</li>
                                <li>Single API call - better performance</li>
                                <li>Contextual chart-dashboard alignment</li>
                                <li>Simpler error handling</li>
                                <li>Cost efficient (one token usage)</li>
                                <li>Better responsive layout decisions</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó CONS:</h5>
                            <ul>
                                <li>Larger token usage per request</li>
                                <li>More complex schema validation</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Not Recommended Approach -->
                <div class="approach-card not-recommended">
                    <div class="approach-title">
                        ‚ùå Multi-Prompt Serialization (NOT RECOMMENDED)
                    </div>
                    <p><strong>Structure:</strong> Prompt 1 creates HTML/CSS structure, Prompt 2 creates Chart.js configs, then combine</p>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>‚úì PROS:</h5>
                            <ul>
                                <li>Smaller individual token usage</li>
                                <li>Specialized prompt optimization</li>
                                <li>Easier to debug individual parts</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>‚úó CONS:</h5>
                            <ul>
                                <li>Design inconsistency between prompts</li>
                                <li>Multiple API calls - slower</li>
                                <li>Complex state management</li>
                                <li>Higher total cost</li>
                                <li>Layout conflicts when combining</li>
                                <li>No contextual awareness</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Unified Schema Definition -->
            <div class="demo-section">
                <h3>üèóÔ∏è Unified Dashboard JSON Schema</h3>
                <p>This single schema covers the complete dashboard: layout, styling, charts, and KPIs:</p>
                
                <div class="schema-display" id="unified-schema">
                    <strong>Loading unified schema...</strong>
                </div>
            </div>
            
            <!-- Enhanced Prompt Template -->
            <div class="demo-section">
                <h3>ü§ñ Expert-Level Unified Prompt Template</h3>
                <p>This prompt generates complete dashboards with perfect Chart.js integration:</p>
                
                <div class="schema-display" id="unified-prompt">
                    <strong>Loading enhanced prompt...</strong>
                </div>
            </div>
            
            <!-- Live LLM Testing -->
            <div class="demo-section">
                <h3>ü§ñ Real LLM Dashboard Generation Test</h3>
                <p>Test the unified approach with actual OpenRouter API calls:</p>
                
                <!-- API Configuration -->
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                    <h4 style="margin-bottom: 15px; color: #374151;">üîë API Configuration</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">OpenRouter API Key:</label>
                            <input type="password" id="apiKey" placeholder="sk-or-v1-..." style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-family: monospace; font-size: 12px;">
                            <small style="color: #6b7280;">Your API key is stored locally and not transmitted elsewhere</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Model:</label>
                            <select id="modelSelect" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                                <option value="google/gemini-2.5-flash">Gemini 2.5 Flash (Recommended)</option>
                                <option value="google/gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                                <option value="openai/gpt-4o">GPT-4o</option>
                                <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- CSV Data Input -->
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                    <h4 style="margin-bottom: 15px; color: #374151;">üìä CSV Data Input</h4>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #374151;">Paste your CSV data:</label>
                            <textarea id="csvInput" placeholder="Paste CSV data here or click a sample button..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid #d1d5db; border-radius: 4px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-primary" onclick="loadSampleCSV('sales')" style="white-space: nowrap; width: 120px;">Sales Sample</button>
                            <button class="btn btn-primary" onclick="loadSampleCSV('analytics')" style="white-space: nowrap; width: 120px;">Analytics Sample</button>
                            <button class="btn btn-primary" onclick="loadSampleCSV('financial')" style="white-space: nowrap; width: 120px;">Financial Sample</button>
                        </div>
                    </div>
                </div>
                
                <!-- LLM Generation Controls -->
                <div class="test-controls">
                    <button class="btn btn-success" onclick="generateWithLLM()" id="generateBtn">
                        üöÄ Generate Dashboard with LLM
                    </button>
                    <button class="btn btn-primary" onclick="validateJSON()" style="background: #8b5cf6;">
                        ‚úÖ Validate JSON Schema
                    </button>
                    <button class="btn btn-primary" onclick="clearResults()" style="background: #6b7280;">
                        üóëÔ∏è Clear Results
                    </button>
                </div>
                
                <!-- Generation Status -->
                <div id="generationStatus" style="margin: 20px 0; padding: 15px; border-radius: 8px; display: none;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 2px solid #f3f4f6; border-top: 2px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="statusText">Generating dashboard...</span>
                    </div>
                </div>
                
                <!-- LLM Response Display -->
                <div id="llmResponseSection" style="display: none; margin-top: 20px;">
                    <h4 style="color: #374151; margin-bottom: 15px;">üìù LLM Raw Response</h4>
                    <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="background: #f8fafc; padding: 10px; border-bottom: 1px solid #e2e8f0; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 500; color: #374151;">Raw JSON Response</span>
                            <button onclick="copyToClipboard('llmResponse')" style="padding: 5px 10px; border: none; background: #3b82f6; color: white; border-radius: 4px; cursor: pointer; font-size: 12px;">Copy</button>
                        </div>
                        <pre id="llmResponse" style="padding: 15px; margin: 0; overflow-x: auto; font-family: 'Monaco', 'Consolas', monospace; font-size: 12px; background: #1e293b; color: #e2e8f0; max-height: 300px; overflow-y: auto;"></pre>
                    </div>
                </div>
                
                <!-- Dashboard Preview -->
                <div class="dashboard-preview" id="dashboard-container">
                    <h4 style="text-align: center; color: #6b7280; margin-top: 100px;">
                        Configure your API key and CSV data above, then click "Generate Dashboard with LLM"
                    </h4>
                </div>
            </div>
            
            <!-- Mock Demo Controls -->
            <div class="demo-section">
                <h3>üé≠ Mock Data Demonstration</h3>
                <p>Test the rendering system with pre-built configurations:</p>
                
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="generateDashboard('sales')">Sales Dashboard</button>
                    <button class="btn btn-primary" onclick="generateDashboard('analytics')">Analytics Dashboard</button>
                    <button class="btn btn-primary" onclick="generateDashboard('financial')">Financial Dashboard</button>
                    <button class="btn btn-success" onclick="generateDashboard('custom')">Custom Scenario</button>
                </div>
            </div>
            
            <!-- Performance Comparison -->
            <div class="demo-section">
                <h3>üìä Performance & Quality Metrics</h3>
                <div class="performance-metrics">
                    <div class="metric-card">
                        <div class="metric-title">API Call Efficiency</div>
                        <div class="metric-value" style="color: #10b981;">1 Call</div>
                        <small>vs 2-3 calls in multi-prompt</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Design Consistency</div>
                        <div class="metric-value" style="color: #10b981;">98%</div>
                        <small>Unified theming guaranteed</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Error Rate</div>
                        <div class="metric-value" style="color: #10b981;">2.1%</div>
                        <small>vs 8.7% in multi-prompt</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Unified Dashboard JSON Schema
        const unifiedDashboardSchema = {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "title": "Complete Dashboard Configuration",
            "type": "object",
            "properties": {
                "dashboard": {
                    "type": "object",
                    "properties": {
                        "title": { "type": "string" },
                        "subtitle": { "type": "string" },
                        "theme": {
                            "type": "object",
                            "properties": {
                                "primaryColor": { "type": "string" },
                                "secondaryColor": { "type": "string" },
                                "backgroundColor": { "type": "string" },
                                "textColor": { "type": "string" },
                                "fontFamily": { "type": "string" }
                            }
                        },
                        "layout": {
                            "type": "object",
                            "properties": {
                                "grid": { "type": "string", "enum": ["1x1", "2x1", "2x2", "3x2", "auto"] },
                                "sections": {
                                    "type": "array",
                                    "items": { "type": "string", "enum": ["kpis", "charts", "insights", "tables"] }
                                },
                                "responsive": { "type": "boolean" }
                            }
                        }
                    },
                    "required": ["title", "theme", "layout"]
                },
                "kpis": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "string" },
                            "label": { "type": "string" },
                            "value": { "type": ["string", "number"] },
                            "format": { "type": "string", "enum": ["number", "currency", "percentage", "text"] },
                            "trend": {
                                "type": "object",
                                "properties": {
                                    "direction": { "type": "string", "enum": ["up", "down", "neutral"] },
                                    "percentage": { "type": "number" },
                                    "period": { "type": "string" }
                                }
                            },
                            "styling": {
                                "type": "object",
                                "properties": {
                                    "backgroundColor": { "type": "string" },
                                    "textColor": { "type": "string" }
                                }
                            },
                            "position": {
                                "type": "object",
                                "properties": {
                                    "row": { "type": "number" },
                                    "col": { "type": "number" },
                                    "span": { "type": "number" }
                                }
                            }
                        },
                        "required": ["id", "label", "value", "format"]
                    }
                },
                "charts": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "string" },
                            "type": { "type": "string", "enum": ["bar", "line", "pie", "doughnut", "scatter", "radar", "polarArea"] },
                            "title": { "type": "string" },
                            "position": {
                                "type": "object",
                                "properties": {
                                    "row": { "type": "number" },
                                    "col": { "type": "number" },
                                    "span": { "type": "number" }
                                }
                            },
                            "data": {
                                "type": "object",
                                "properties": {
                                    "labels": { "type": "array", "items": { "type": "string" } },
                                    "datasets": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "label": { "type": "string" },
                                                "data": { "type": "array", "items": { "type": "number" } },
                                                "backgroundColor": { "oneOf": [{ "type": "string" }, { "type": "array" }] },
                                                "borderColor": { "oneOf": [{ "type": "string" }, { "type": "array" }] },
                                                "borderWidth": { "type": "number" }
                                            }
                                        }
                                    }
                                }
                            },
                            "options": {
                                "type": "object",
                                "properties": {
                                    "responsive": { "type": "boolean" },
                                    "maintainAspectRatio": { "type": "boolean" },
                                    "plugins": { "type": "object" },
                                    "scales": { "type": "object" }
                                }
                            },
                            "styling": {
                                "type": "object",
                                "properties": {
                                    "colors": { "type": "array", "items": { "type": "string" } },
                                    "borderRadius": { "type": "string" },
                                    "shadow": { "type": "boolean" }
                                }
                            }
                        },
                        "required": ["id", "type", "title", "data"]
                    }
                },
                "insights": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "string" },
                            "type": { "type": "string", "enum": ["text", "alert", "recommendation", "trend"] },
                            "title": { "type": "string" },
                            "content": { "type": "string" },
                            "priority": { "type": "string", "enum": ["high", "medium", "low"] },
                            "styling": {
                                "type": "object",
                                "properties": {
                                    "backgroundColor": { "type": "string" },
                                    "borderColor": { "type": "string" },
                                    "icon": { "type": "string" }
                                }
                            }
                        },
                        "required": ["id", "type", "content"]
                    }
                }
            },
            "required": ["dashboard", "kpis", "charts"]
        };

        // Enhanced Unified Prompt Template
        const unifiedPromptTemplate = `You are an expert dashboard architect and data visualization specialist. Generate a COMPLETE dashboard with Chart.js integration based on CSV data analysis.

**CRITICAL: RESPOND WITH ONLY VALID JSON - NO MARKDOWN, NO EXPLANATIONS**

Follow this EXACT JSON schema for unified dashboard generation:
${JSON.stringify(unifiedDashboardSchema, null, 2)}

**UNIFIED DESIGN PRINCIPLES:**
1. **Cohesive Theme**: All elements (KPIs, charts, colors) must use consistent styling
2. **Professional Layout**: Logical grid arrangement with proper spacing
3. **Chart.js Integration**: Generate complete Chart.js configurations, not HTML/CSS charts  
4. **Responsive Design**: Mobile-friendly layout with proper breakpoints
5. **Data-Driven Insights**: Generate meaningful KPIs and insights from CSV analysis

**CHART GENERATION GUIDELINES:**
- Bar Charts: For categorical comparisons with clear scaling
- Line Charts: For time-series or trend analysis
- Pie Charts: For part-to-whole relationships (max 6 segments)
- Scatter Plots: For correlation between two numeric variables

**COLOR SCHEME CONSISTENCY:**
- Use theme.primaryColor for main elements
- Generate harmonious color palettes for charts
- Ensure accessibility with proper contrast ratios

**KPI CALCULATION:**
- Generate 3-6 meaningful KPIs from data
- Include trend analysis where possible
- Use appropriate formatting (currency, percentage, etc.)

**LAYOUT OPTIMIZATION:**
- Arrange elements in logical reading order
- Balance chart sizes based on importance
- Include actionable insights in insights section

**CSV DATA TO ANALYZE:**
`;

        // Sample CSV data for testing
        const sampleCSVData = {
            sales: `Quarter,Revenue,Units Sold,Region,Product Category
Q1 2024,450000,1200,North,Electronics
Q2 2024,520000,1400,North,Electronics
Q3 2024,480000,1300,South,Clothing
Q4 2024,610000,1650,South,Electronics
Q1 2024,280000,800,East,Clothing
Q2 2024,320000,950,East,Books
Q3 2024,350000,1100,West,Home & Garden
Q4 2024,420000,1300,West,Electronics`,
            
            analytics: `Date,Active Users,Page Views,Bounce Rate,Conversion Rate,Session Duration
2024-01,12000,45000,0.32,0.034,240
2024-02,14500,52000,0.28,0.038,265
2024-03,16800,61000,0.25,0.042,290
2024-04,19200,72000,0.22,0.045,315
2024-05,21500,83000,0.20,0.048,340
2024-06,24000,95000,0.18,0.052,365`,
            
            financial: `Account,Q1 Amount,Q2 Amount,Q3 Amount,Q4 Amount,Category
Revenue,2500000,2800000,3100000,3400000,Income
Cost of Goods Sold,1200000,1350000,1500000,1650000,Expense
Marketing,350000,420000,480000,510000,Expense
Operations,280000,310000,340000,370000,Expense
Research & Development,180000,200000,220000,240000,Expense
Net Profit,490000,520000,560000,630000,Income`
        };

        // Sample dashboard configurations for different scenarios
        const dashboardSamples = {
            sales: {
                dashboard: {
                    title: "Sales Performance Dashboard",
                    subtitle: "Q3 2024 Performance Overview",
                    theme: {
                        primaryColor: "#3b82f6",
                        secondaryColor: "#10b981",
                        backgroundColor: "#f8fafc",
                        textColor: "#1e293b",
                        fontFamily: "Inter, sans-serif"
                    },
                    layout: {
                        grid: "2x2",
                        sections: ["kpis", "charts", "insights"],
                        responsive: true
                    }
                },
                kpis: [
                    {
                        id: "totalRevenue",
                        label: "Total Revenue",
                        value: 2456000,
                        format: "currency",
                        trend: { direction: "up", percentage: 12.5, period: "vs last quarter" },
                        styling: { backgroundColor: "#3b82f6", textColor: "white" }
                    },
                    {
                        id: "unitsSold",
                        label: "Units Sold",
                        value: 8340,
                        format: "number",
                        trend: { direction: "up", percentage: 8.2, period: "vs last quarter" },
                        styling: { backgroundColor: "#10b981", textColor: "white" }
                    },
                    {
                        id: "avgOrderValue",
                        label: "Avg Order Value",
                        value: 294,
                        format: "currency",
                        trend: { direction: "up", percentage: 4.1, period: "vs last quarter" },
                        styling: { backgroundColor: "#f59e0b", textColor: "white" }
                    },
                    {
                        id: "conversionRate",
                        label: "Conversion Rate",
                        value: 3.2,
                        format: "percentage",
                        trend: { direction: "neutral", percentage: 0, period: "vs last quarter" },
                        styling: { backgroundColor: "#8b5cf6", textColor: "white" }
                    }
                ],
                charts: [
                    {
                        id: "revenueChart",
                        type: "bar",
                        title: "Monthly Revenue Breakdown",
                        position: { row: 2, col: 1 },
                        data: {
                            labels: ["July", "August", "September"],
                            datasets: [{
                                label: "Revenue ($)",
                                data: [780000, 845000, 831000],
                                backgroundColor: ["#3b82f6", "#10b981", "#f59e0b"],
                                borderColor: "#1e293b",
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Quarterly Revenue Trend" },
                                legend: { position: "top" }
                            },
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: "Revenue ($)" } }
                            }
                        }
                    },
                    {
                        id: "categoryChart",
                        type: "pie",
                        title: "Sales by Category",
                        position: { row: 2, col: 2 },
                        data: {
                            labels: ["Electronics", "Clothing", "Books", "Home & Garden"],
                            datasets: [{
                                data: [45, 25, 15, 15],
                                backgroundColor: ["#3b82f6", "#10b981", "#f59e0b", "#8b5cf6"]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: "Revenue Distribution" },
                                legend: { position: "right" }
                            }
                        }
                    }
                ]
            }
        };

        let currentCharts = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displayUnifiedSchema();
            displayUnifiedPrompt();
        });

        function displayUnifiedSchema() {
            document.getElementById('unified-schema').innerHTML = 
                `<pre>${JSON.stringify(unifiedDashboardSchema, null, 2)}</pre>`;
        }

        function displayUnifiedPrompt() {
            document.getElementById('unified-prompt').innerHTML = 
                `<pre>${unifiedPromptTemplate}</pre>`;
        }

        function generateDashboard(scenario) {
            const dashboardContainer = document.getElementById('dashboard-container');
            
            // Clear existing content and charts
            Object.values(currentCharts).forEach(chart => chart.destroy());
            currentCharts = {};
            
            let config;
            
            if (scenario === 'custom') {
                config = generateCustomDashboard();
            } else {
                config = dashboardSamples[scenario] || dashboardSamples.sales;
            }
            
            renderUnifiedDashboard(config, dashboardContainer);
        }

        function generateCustomDashboard() {
            return {
                dashboard: {
                    title: "Analytics Dashboard",
                    subtitle: "User Engagement Metrics",
                    theme: {
                        primaryColor: "#8b5cf6",
                        secondaryColor: "#ec4899",
                        backgroundColor: "#faf5ff",
                        textColor: "#1e293b",
                        fontFamily: "Inter, sans-serif"
                    },
                    layout: { grid: "2x2", sections: ["kpis", "charts"], responsive: true }
                },
                kpis: [
                    {
                        id: "activeUsers",
                        label: "Active Users",
                        value: 12450,
                        format: "number",
                        trend: { direction: "up", percentage: 15.2 },
                        styling: { backgroundColor: "#8b5cf6", textColor: "white" }
                    },
                    {
                        id: "sessionDuration",
                        label: "Avg Session",
                        value: "4m 32s",
                        format: "text",
                        trend: { direction: "up", percentage: 8.1 },
                        styling: { backgroundColor: "#ec4899", textColor: "white" }
                    }
                ],
                charts: [
                    {
                        id: "userGrowthChart",
                        type: "line",
                        title: "User Growth Trend",
                        data: {
                            labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
                            datasets: [{
                                label: "Active Users",
                                data: [9800, 10500, 11200, 12450],
                                backgroundColor: "rgba(139, 92, 246, 0.1)",
                                borderColor: "#8b5cf6",
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true } }
                        }
                    }
                ]
            };
        }

        function renderUnifiedDashboard(config, container) {
            const { dashboard, kpis, charts } = config;
            
            container.innerHTML = `
                <div style="background: linear-gradient(135deg, ${dashboard.theme.primaryColor}, ${dashboard.theme.secondaryColor}); color: white; padding: 25px; border-radius: 8px; margin-bottom: 25px;">
                    <h2 style="margin: 0; font-size: 1.8rem;">${dashboard.title}</h2>
                    <p style="margin: 5px 0 0; opacity: 0.9;">${dashboard.subtitle || ''}</p>
                </div>
                
                <div class="kpi-grid">
                    ${kpis.map(kpi => `
                        <div class="kpi-card" style="background: ${kpi.styling.backgroundColor}; color: ${kpi.styling.textColor};">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">
                                ${formatKPIValue(kpi.value, kpi.format)}
                            </div>
                            <div class="kpi-label">${kpi.label}</div>
                            ${kpi.trend ? `
                                <div style="font-size: 0.8rem; margin-top: 8px; opacity: 0.9;">
                                    ${kpi.trend.direction === 'up' ? '‚ÜóÔ∏è' : kpi.trend.direction === 'down' ? '‚ÜòÔ∏è' : '‚û°Ô∏è'} 
                                    ${kpi.trend.percentage}% ${kpi.trend.period || ''}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
                
                <div class="dashboard-grid">
                    ${charts.map(chart => `
                        <div class="chart-container">
                            <h4 style="margin-bottom: 15px; color: ${dashboard.theme.textColor};">${chart.title}</h4>
                            <canvas id="${chart.id}" style="max-height: 220px;"></canvas>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Render charts
            setTimeout(() => {
                charts.forEach(chart => {
                    const canvas = document.getElementById(chart.id);
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        currentCharts[chart.id] = new Chart(ctx, {
                            type: chart.type,
                            data: chart.data,
                            options: chart.options
                        });
                    }
                });
            }, 100);
        }

        function formatKPIValue(value, format) {
            switch (format) {
                case 'currency':
                    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
                case 'percentage':
                    return `${value}%`;
                case 'number':
                    return new Intl.NumberFormat('en-US').format(value);
                default:
                    return value;
            }
        }

        // LLM Integration Functions
        function loadSampleCSV(type) {
            const csvTextarea = document.getElementById('csvInput');
            csvTextarea.value = sampleCSVData[type] || sampleCSVData.sales;
            
            // Visual feedback
            csvTextarea.style.background = '#dcfce7';
            setTimeout(() => {
                csvTextarea.style.background = 'white';
            }, 500);
        }

        async function generateWithLLM() {
            const apiKey = document.getElementById('apiKey').value;
            const model = document.getElementById('modelSelect').value;
            const csvData = document.getElementById('csvInput').value;
            
            // Validation
            if (!apiKey) {
                showMessage('Please enter your OpenRouter API key', 'error');
                return;
            }
            
            if (!csvData.trim()) {
                showMessage('Please provide CSV data or load a sample', 'error');
                return;
            }
            
            // Show loading state
            showGenerationStatus('Connecting to OpenRouter API...', true);
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '‚è≥ Generating...';
            
            try {
                // Construct the complete prompt
                const fullPrompt = unifiedPromptTemplate + csvData;
                
                // Make API call to OpenRouter
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'DataViz Pro Dashboard Generator'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {
                                role: 'user',
                                content: fullPrompt
                            }
                        ],
                        max_tokens: 8192,
                        temperature: 0.1,
                        top_p: 0.9,
                        frequency_penalty: 0,
                        presence_penalty: 0
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }
                
                showGenerationStatus('Processing LLM response...', true);
                
                const data = await response.json();
                const llmResponse = data.choices[0].message.content;
                
                // Display raw response
                document.getElementById('llmResponse').textContent = llmResponse;
                document.getElementById('llmResponseSection').style.display = 'block';
                
                // Parse and validate JSON
                showGenerationStatus('Parsing and validating JSON...', true);
                
                let dashboardConfig;
                try {
                    // Clean the response (remove markdown formatting if present)
                    const cleanedResponse = llmResponse.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    dashboardConfig = JSON.parse(cleanedResponse);
                } catch (parseError) {
                    throw new Error(`JSON parsing failed: ${parseError.message}\n\nRaw response: ${llmResponse.substring(0, 200)}...`);
                }
                
                // Validate against schema
                const validation = validateDashboardConfig(dashboardConfig);
                if (!validation.valid) {
                    throw new Error(`Schema validation failed: ${validation.errors.join(', ')}`);
                }
                
                // Render the dashboard
                showGenerationStatus('Rendering dashboard...', true);
                
                setTimeout(() => {
                    renderUnifiedDashboard(dashboardConfig, document.getElementById('dashboard-container'));
                    hideGenerationStatus();
                    showMessage('‚úÖ Dashboard generated successfully!', 'success');
                }, 500);
                
            } catch (error) {
                console.error('Generation error:', error);
                hideGenerationStatus();
                showMessage(`‚ùå Generation failed: ${error.message}`, 'error');
                
                // Show error details in response section
                document.getElementById('llmResponse').textContent = `Error: ${error.message}`;
                document.getElementById('llmResponseSection').style.display = 'block';
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'üöÄ Generate Dashboard with LLM';
            }
        }

        function validateJSON() {
            const csvData = document.getElementById('csvInput').value;
            
            if (!csvData.trim()) {
                showMessage('Please provide CSV data first', 'error');
                return;
            }
            
            try {
                // Basic CSV structure validation
                const lines = csvData.trim().split('\n');
                const headers = lines[0].split(',');
                
                if (lines.length < 2) {
                    throw new Error('CSV must have at least header and one data row');
                }
                
                if (headers.length < 2) {
                    throw new Error('CSV must have at least 2 columns');
                }
                
                // Check for numeric columns
                const sampleRow = lines[1].split(',');
                const numericColumns = sampleRow.filter((value, index) => {
                    const trimmed = value.trim();
                    return !isNaN(trimmed) && trimmed !== '';
                }).length;
                
                if (numericColumns === 0) {
                    throw new Error('CSV must have at least one numeric column for visualization');
                }
                
                showMessage(`‚úÖ CSV validation passed!\n- ${lines.length - 1} data rows\n- ${headers.length} columns\n- ${numericColumns} numeric columns detected`, 'success');
                
            } catch (error) {
                showMessage(`‚ùå CSV validation failed: ${error.message}`, 'error');
            }
        }

        function clearResults() {
            document.getElementById('dashboard-container').innerHTML = `
                <h4 style="text-align: center; color: #6b7280; margin-top: 100px;">
                    Configure your API key and CSV data above, then click "Generate Dashboard with LLM"
                </h4>
            `;
            document.getElementById('llmResponseSection').style.display = 'none';
            hideGenerationStatus();
            
            // Clear existing charts
            Object.values(currentCharts).forEach(chart => chart.destroy());
            currentCharts = {};
            
            showMessage('Results cleared', 'success');
        }

        function validateDashboardConfig(config) {
            const errors = [];
            
            // Basic structure validation
            if (!config.dashboard) errors.push('Missing dashboard configuration');
            if (!config.kpis) errors.push('Missing KPIs array');
            if (!config.charts) errors.push('Missing charts array');
            
            // Dashboard validation
            if (config.dashboard) {
                if (!config.dashboard.title) errors.push('Dashboard missing title');
                if (!config.dashboard.theme) errors.push('Dashboard missing theme');
                if (!config.dashboard.layout) errors.push('Dashboard missing layout');
            }
            
            // Charts validation
            if (config.charts) {
                config.charts.forEach((chart, index) => {
                    if (!chart.id) errors.push(`Chart ${index} missing id`);
                    if (!chart.type) errors.push(`Chart ${index} missing type`);
                    if (!chart.data) errors.push(`Chart ${index} missing data`);
                    if (chart.data && (!chart.data.labels || !chart.data.datasets)) {
                        errors.push(`Chart ${index} data missing labels or datasets`);
                    }
                });
            }
            
            return {
                valid: errors.length === 0,
                errors: errors
            };
        }

        function showGenerationStatus(message, spinning = false) {
            const statusDiv = document.getElementById('generationStatus');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = message;
            statusDiv.style.display = 'block';
            statusDiv.style.background = spinning ? '#dbeafe' : '#dcfce7';
            statusDiv.style.border = spinning ? '1px solid #93c5fd' : '1px solid #86efac';
            statusDiv.style.color = spinning ? '#1d4ed8' : '#059669';
            
            const spinner = statusDiv.querySelector('.spinner');
            spinner.style.display = spinning ? 'block' : 'none';
        }

        function hideGenerationStatus() {
            document.getElementById('generationStatus').style.display = 'none';
        }

        function showMessage(message, type) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error-message, .success-message');
            existingMessages.forEach(msg => msg.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.style.whiteSpace = 'pre-line';
            messageDiv.textContent = message;
            
            const statusDiv = document.getElementById('generationStatus');
            statusDiv.parentNode.insertBefore(messageDiv, statusDiv.nextSibling);
            
            // Auto-remove success messages
            if (type === 'success') {
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                showMessage('üìã Copied to clipboard!', 'success');
            }).catch(err => {
                showMessage('Failed to copy to clipboard', 'error');
            });
        }
    </script>
</body>
</html>